{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "AgentDB HNSW Parameters Configuration",
  "description": "Optimize HNSW index for 150x-12,500x search performance",
  "type": "object",

  "presets": {
    "small": {
      "description": "Small datasets (<10K vectors) - Fast build, minimal memory",
      "datasetSize": "< 10,000 vectors",
      "hnswM": 8,
      "hnswEfConstruction": 100,
      "hnswEfSearch": 50,
      "cacheSize": 500,
      "quantizationType": "none",
      "expectedPerformance": {
        "searchLatency": "< 100µs",
        "recallRate": "95-98%",
        "buildTime": "< 1 second",
        "memoryUsage": "Low"
      }
    },

    "medium": {
      "description": "Medium datasets (10K-100K) - Balanced performance",
      "datasetSize": "10,000 - 100,000 vectors",
      "hnswM": 16,
      "hnswEfConstruction": 200,
      "hnswEfSearch": 100,
      "cacheSize": 1000,
      "quantizationType": "scalar",
      "expectedPerformance": {
        "searchLatency": "< 200µs",
        "recallRate": "97-99%",
        "buildTime": "5-30 seconds",
        "memoryUsage": "Medium"
      }
    },

    "large": {
      "description": "Large datasets (100K-1M) - High quality index",
      "datasetSize": "100,000 - 1,000,000 vectors",
      "hnswM": 32,
      "hnswEfConstruction": 400,
      "hnswEfSearch": 200,
      "cacheSize": 2000,
      "quantizationType": "binary",
      "expectedPerformance": {
        "searchLatency": "< 500µs",
        "recallRate": "98-99.5%",
        "buildTime": "1-5 minutes",
        "memoryUsage": "High"
      }
    },

    "massive": {
      "description": "Massive datasets (>1M vectors) - Maximum performance",
      "datasetSize": "> 1,000,000 vectors",
      "hnswM": 48,
      "hnswEfConstruction": 500,
      "hnswEfSearch": 250,
      "cacheSize": 5000,
      "quantizationType": "binary",
      "expectedPerformance": {
        "searchLatency": "< 2ms",
        "recallRate": "99%+",
        "buildTime": "10-30 minutes",
        "memoryUsage": "Very High"
      }
    }
  },

  "parameters": {
    "hnswM": {
      "description": "Number of bi-directional connections per layer",
      "type": "integer",
      "minimum": 4,
      "maximum": 64,
      "default": 16,
      "recommendations": {
        "small": 8,
        "medium": 16,
        "large": 32,
        "massive": 48
      },
      "notes": [
        "Higher M = better recall, more memory usage",
        "Lower M = less memory, potentially lower recall",
        "Recommended: 8-16 for small, 16-32 for medium, 32-48 for large"
      ]
    },

    "hnswEfConstruction": {
      "description": "Size of dynamic candidate list during index construction",
      "type": "integer",
      "minimum": 50,
      "maximum": 1000,
      "default": 200,
      "recommendations": {
        "fast": 100,
        "balanced": 200,
        "quality": 400
      },
      "notes": [
        "Higher efConstruction = better index quality, slower build",
        "Lower efConstruction = faster build, potentially lower quality",
        "Should be >= M and typically 2-4x M"
      ]
    },

    "hnswEfSearch": {
      "description": "Size of dynamic candidate list during search",
      "type": "integer",
      "minimum": 10,
      "maximum": 500,
      "default": 100,
      "recommendations": {
        "fast": 50,
        "balanced": 100,
        "accurate": 200
      },
      "notes": [
        "Higher efSearch = better recall, slower search",
        "Lower efSearch = faster search, potentially lower recall",
        "Can be tuned independently after index construction"
      ]
    },

    "cacheSize": {
      "description": "Number of patterns to cache in memory",
      "type": "integer",
      "minimum": 0,
      "maximum": 10000,
      "default": 1000,
      "recommendations": {
        "minimal": 100,
        "small": 500,
        "medium": 1000,
        "large": 2000,
        "massive": 5000
      },
      "notes": [
        "Cache stores most frequently accessed patterns",
        "Larger cache = higher memory, better hit rate",
        "Recommended: 500-2000 for most applications"
      ]
    },

    "quantizationType": {
      "description": "Vector quantization method for memory optimization",
      "type": "string",
      "enum": ["none", "scalar", "binary", "product"],
      "default": "scalar",
      "options": {
        "none": {
          "memoryReduction": "1x",
          "accuracyLoss": "0%",
          "useCase": "Maximum accuracy, small datasets"
        },
        "scalar": {
          "memoryReduction": "4x",
          "accuracyLoss": "1-2%",
          "useCase": "Balanced performance, production apps"
        },
        "binary": {
          "memoryReduction": "32x",
          "accuracyLoss": "2-5%",
          "useCase": "Mobile/edge, large-scale (1M+ vectors)"
        },
        "product": {
          "memoryReduction": "8-16x",
          "accuracyLoss": "3-7%",
          "useCase": "High-dimensional vectors, large-scale"
        }
      }
    }
  },

  "tuningGuide": {
    "recallTooLow": {
      "problem": "Search recall rate below acceptable threshold",
      "solutions": [
        "Increase efSearch (e.g., 100 → 200)",
        "Increase M (e.g., 16 → 32)",
        "Rebuild index with higher efConstruction",
        "Use lighter quantization (binary → scalar → none)"
      ]
    },

    "searchTooSlow": {
      "problem": "Search latency exceeds requirements",
      "solutions": [
        "Decrease efSearch (e.g., 200 → 100)",
        "Increase cache size",
        "Enable more aggressive quantization",
        "Reduce M if acceptable recall maintained"
      ]
    },

    "buildTooSlow": {
      "problem": "Index construction takes too long",
      "solutions": [
        "Decrease efConstruction (e.g., 400 → 200)",
        "Use smaller M",
        "Process in batches",
        "Use parallel construction"
      ]
    },

    "memoryTooHigh": {
      "problem": "Memory usage exceeds available resources",
      "solutions": [
        "Enable quantization (scalar or binary)",
        "Reduce cache size",
        "Decrease M",
        "Prune low-confidence patterns"
      ]
    }
  },

  "benchmarks": {
    "description": "Expected performance metrics on AMD Ryzen 9 5950X, 64GB RAM",
    "results": [
      {
        "datasetSize": "10K vectors",
        "unoptimized": {
          "searchLatency": "15ms",
          "method": "Linear scan"
        },
        "optimized": {
          "searchLatency": "100µs",
          "method": "HNSW index",
          "improvement": "150x"
        }
      },
      {
        "datasetSize": "100K vectors",
        "unoptimized": {
          "searchLatency": "150ms",
          "method": "Linear scan"
        },
        "optimized": {
          "searchLatency": "120µs",
          "method": "HNSW index",
          "improvement": "1,250x"
        }
      },
      {
        "datasetSize": "1M vectors",
        "unoptimized": {
          "searchLatency": "100s",
          "method": "Linear scan"
        },
        "optimized": {
          "searchLatency": "8ms",
          "method": "HNSW index + binary quantization",
          "improvement": "12,500x"
        }
      }
    ]
  },

  "examples": [
    {
      "name": "Small Dataset - Maximum Speed",
      "config": {
        "hnswM": 8,
        "hnswEfConstruction": 100,
        "hnswEfSearch": 50,
        "cacheSize": 500,
        "quantizationType": "binary"
      },
      "expectedResult": "< 50µs search, 90-95% recall"
    },
    {
      "name": "Medium Dataset - Balanced",
      "config": {
        "hnswM": 16,
        "hnswEfConstruction": 200,
        "hnswEfSearch": 100,
        "cacheSize": 1000,
        "quantizationType": "scalar"
      },
      "expectedResult": "< 100µs search, 98-99% recall"
    },
    {
      "name": "Large Dataset - Maximum Accuracy",
      "config": {
        "hnswM": 32,
        "hnswEfConstruction": 400,
        "hnswEfSearch": 200,
        "cacheSize": 2000,
        "quantizationType": "none"
      },
      "expectedResult": "< 200µs search, 100% recall"
    },
    {
      "name": "Mobile/Edge - Memory Constrained",
      "config": {
        "hnswM": 8,
        "hnswEfConstruction": 100,
        "hnswEfSearch": 50,
        "cacheSize": 100,
        "quantizationType": "binary"
      },
      "expectedResult": "< 100µs search, ~10MB for 100K vectors"
    }
  ]
}
