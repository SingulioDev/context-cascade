// AI Dev Orchestration Process Flow v2.1.0
// Meta-orchestrator for AI-assisted app development with behavioral guardrails

digraph ai_dev_orchestration {
    rankdir=TB;
    node [shape=box, style="rounded,filled", fontname="Helvetica"];
    edge [fontname="Helvetica", fontsize=10];

    // Colors by phase
    node [fillcolor="#E8F4FD"];

    // Phase 0: Expertise Loading
    subgraph cluster_phase0 {
        label="Phase 0: Expertise Loading";
        style=dashed;
        color="#666666";

        detect_project [label="Detect Project Type\n(web, mobile, API)", fillcolor="#FFF3E0"];
        check_expertise [label="Check Expertise\n.claude/expertise/ai-dev.yaml", fillcolor="#FFF3E0"];
        load_guardrails [label="Load Behavioral\nGuardrails & Templates", fillcolor="#FFF3E0"];

        detect_project -> check_expertise -> load_guardrails;
    }

    // Input
    input [label="Feature Request\nor Bug Report", shape=ellipse, fillcolor="#C8E6C9"];

    // 5-Phase SOP
    subgraph cluster_phase1 {
        label="Phase 1: Product Framing (planner)";
        style=filled;
        color="#FFEBEE";

        define_scope [label="Define Scope\n& Success Criteria"];
        create_dnt [label="Create Do-Not-Touch\nList"];
        feature_prompt [label="Apply Feature Prompt\nFramework"];
    }

    subgraph cluster_phase2 {
        label="Phase 2: Setup & Foundations (system-architect)";
        style=filled;
        color="#E3F2FD";

        arch_review [label="Architecture Review\n& Dependencies"];
        foundation_setup [label="Foundation Setup\n& Configuration"];
        manual_gate1 [label="MANUAL GATE\nArchitecture Approval", shape=diamond, fillcolor="#FFCDD2"];
    }

    subgraph cluster_phase3 {
        label="Phase 3: Feature Dev Loop (coder + tester + reviewer)";
        style=filled;
        color="#E8F5E9";

        fresh_context [label="Fresh Context\nPer Feature"];
        implement [label="Implement\n(coder agent)"];
        test [label="Test\n(tester agent)"];
        review [label="Review\n(reviewer agent)"];
        manual_gate2 [label="MANUAL GATE\nFeature Approval", shape=diamond, fillcolor="#FFCDD2"];
    }

    subgraph cluster_phase4 {
        label="Phase 4: Testing & Refactors (tester + coder)";
        style=filled;
        color="#F3E5F5";

        integration_test [label="Integration\nTesting"];
        refactor [label="Refactoring\n& Cleanup"];
        manual_gate3 [label="MANUAL GATE\nQuality Approval", shape=diamond, fillcolor="#FFCDD2"];
    }

    subgraph cluster_phase5 {
        label="Phase 5: Deployment (cicd-engineer)";
        style=filled;
        color="#FFF3E0";

        deploy_prep [label="Deployment\nPreparation"];
        deploy [label="Deploy to\nProduction", fillcolor="#81C784"];
    }

    // Output
    output [label="Deployed Feature\n+ Compliance Report", shape=ellipse, fillcolor="#BBDEFB"];

    // Connections
    load_guardrails -> input;
    input -> define_scope;
    define_scope -> create_dnt;
    create_dnt -> feature_prompt;
    feature_prompt -> arch_review;
    arch_review -> foundation_setup;
    foundation_setup -> manual_gate1;
    manual_gate1 -> fresh_context [label="approved"];
    fresh_context -> implement;
    implement -> test;
    test -> review;
    review -> manual_gate2;
    manual_gate2 -> integration_test [label="approved"];
    integration_test -> refactor;
    refactor -> manual_gate3;
    manual_gate3 -> deploy_prep [label="approved"];
    deploy_prep -> deploy;
    deploy -> output;

    // Loop back for issues
    manual_gate1 -> define_scope [style=dashed, label="rejected", color="#F44336"];
    manual_gate2 -> implement [style=dashed, label="rejected", color="#F44336"];
    manual_gate3 -> integration_test [style=dashed, label="rejected", color="#F44336"];
}
