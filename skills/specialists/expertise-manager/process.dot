// Expertise Manager Process Flow v2.1.0
// Manages .claude/expertise/ YAML files for domain-specific configurations

digraph expertise_manager {
    rankdir=TB;
    node [shape=box, style="rounded,filled", fontname="Helvetica"];
    edge [fontname="Helvetica", fontsize=10];

    node [fillcolor="#E8F4FD"];

    // Phase 0: Self-Reference
    subgraph cluster_phase0 {
        label="Phase 0: Meta-Expertise Loading";
        style=dashed;
        color="#666666";

        detect_operation [label="Detect Operation\n(create/update/query)", fillcolor="#FFF3E0"];
        check_meta [label="Check Meta-Expertise\n.claude/expertise/expertise-manager.yaml", fillcolor="#FFF3E0"];
        load_schemas [label="Load Expertise\nSchemas & Patterns", fillcolor="#FFF3E0"];

        detect_operation -> check_meta -> load_schemas;
    }

    // Input
    input [label="Expertise Request\n(domain, context)", shape=ellipse, fillcolor="#C8E6C9"];

    // Operations
    subgraph cluster_operations {
        label="Operations Router";
        style=filled;
        color="#E3F2FD";

        route [label="Route by\nOperation Type", shape=diamond];

        // Create path
        create_op [label="CREATE\nNew Expertise"];
        analyze_domain [label="Analyze Domain\nRequirements"];
        generate_yaml [label="Generate YAML\nStructure"];

        // Update path
        update_op [label="UPDATE\nExisting Expertise"];
        load_existing [label="Load Existing\nExpertise File"];
        merge_changes [label="Merge Changes\n& Validate"];

        // Query path
        query_op [label="QUERY\nExpertise"];
        search_expertise [label="Search Expertise\nFiles"];
        return_config [label="Return Matching\nConfiguration"];
    }

    // Validation
    subgraph cluster_validation {
        label="Validation & Storage";
        style=filled;
        color="#E8F5E9";

        validate_schema [label="Validate Against\nSchema"];
        write_file [label="Write to\n.claude/expertise/"];
        update_index [label="Update Expertise\nIndex", fillcolor="#81C784"];
    }

    // Output
    output [label="Expertise File\nCreated/Updated", shape=ellipse, fillcolor="#BBDEFB"];

    // Connections
    load_schemas -> input;
    input -> route;

    route -> create_op [label="create"];
    route -> update_op [label="update"];
    route -> query_op [label="query"];

    create_op -> analyze_domain;
    analyze_domain -> generate_yaml;
    generate_yaml -> validate_schema;

    update_op -> load_existing;
    load_existing -> merge_changes;
    merge_changes -> validate_schema;

    query_op -> search_expertise;
    search_expertise -> return_config;
    return_config -> output;

    validate_schema -> write_file;
    write_file -> update_index;
    update_index -> output;

    // Feedback
    output -> detect_operation [style=dashed, label="Learn from\nusage patterns", color="#FF9800"];
}
